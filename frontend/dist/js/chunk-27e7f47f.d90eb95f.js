(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-27e7f47f"],{2436:function(t,e,a){},"368d":function(t,e,a){"use strict";a("2436")},e43d:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"notify"},[t.loading?e("div",{directives:[{name:"loading",rawName:"v-loading",value:!0,expression:"true"}],staticClass:"loading-box content-none-data"},[t._v("加载中")]):e("div",{staticClass:"card-box"},[t._l(t.dataList,(function(a){return e("div",{staticClass:"card-item"},[e("div",{staticClass:"card-item-top"},[e("el-image",{staticStyle:{width:"60px",height:"60px"},attrs:{src:`/notify/${a.method}.png`,fit:"contain"}}),e("div",{staticStyle:{"margin-left":"12px"}},[e("div",{staticClass:"card-item-user"},[t._v(t._s(t._f("notifyMethodFilter")(a.method)))]),e("div",{class:"card-item-enable enable-"+(1==a.enable?"enable":"disable")},[t._v(" "+t._s(1==a.enable?"已启用":"已禁用")+" ")])])],1),e("div",{staticClass:"card-item-bottom"},[e("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(e){return t.editShowDialog(a)}}},[t._v("编辑")]),0==a.enable?e("el-button",{attrs:{size:"small",type:"success"},on:{click:function(e){return t.enableNotify(a.id,1)}}},[t._v("启用")]):e("el-button",{attrs:{size:"small",type:"warning"},on:{click:function(e){return t.enableNotify(a.id,0)}}},[t._v("禁用")]),e("el-button",{attrs:{size:"small",type:"primary",loading:t.tstLoading},on:{click:function(e){return t.tstCu(a)}}},[t._v("测试")]),e("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(e){return t.delCu(a.id)}}},[t._v("删除")])],1)])})),t.loading?t._e():e("div",{staticClass:"card-item card-add",on:{click:t.addShow}},[0==t.dataList.length?[t._v(" 暂无通知配置，请"),e("span",{staticStyle:{color:"#409eff"}},[t._v("新增")])]:e("span",[t._v("新增")])],2),e("el-dialog",{attrs:{"close-on-click-modal":!1,top:"6vh",visible:t.editShow,title:t.editFlag?"编辑":"新增",width:"680px","before-close":t.closeShow,"append-to-body":!0},on:{"update:visible":function(e){t.editShow=e}}},[e("div",{staticClass:"elform-box"},[t.editShow?e("el-form",{ref:"addRule",attrs:{model:t.editData,rules:t.editRule[t.editData.method],"label-width":"100px"}},[e("el-form-item",{attrs:{prop:"enable",label:"是否启用"}},[e("el-switch",{attrs:{"active-value":1,"inactive-value":0},model:{value:t.editData.enable,callback:function(e){t.$set(t.editData,"enable",e)},expression:"editData.enable"}})],1),e("el-form-item",{attrs:{prop:"method",label:"方式"}},[e("el-select",{staticStyle:{width:"100%"},on:{change:t.methodChange},model:{value:t.editData.method,callback:function(e){t.$set(t.editData,"method",e)},expression:"editData.method"}},t._l(t.notifyMethodLength,(function(a){return e("el-option",{key:a-1,attrs:{value:a-1,label:t._f("notifyMethodFilter")(a-1)}})})),1)],1),0==t.editData.method?[e("el-form-item",{attrs:{prop:"params.url",label:"请求地址"}},[e("el-input",{attrs:{placeholder:"请输入请求地址"},model:{value:t.editData.params.url,callback:function(e){t.$set(t.editData.params,"url",e)},expression:"editData.params.url"}})],1),e("el-form-item",{attrs:{prop:"params.method",label:"请求方法"}},[e("el-select",{staticStyle:{width:"100%"},model:{value:t.editData.params.method,callback:function(e){t.$set(t.editData.params,"method",e)},expression:"editData.params.method"}},[e("el-option",{key:"POST",attrs:{value:"POST",label:"POST"}}),e("el-option",{key:"PUT",attrs:{value:"PUT",label:"PUT"}}),e("el-option",{key:"GET",attrs:{value:"GET",label:"GET"}})],1)],1),"GET"!=t.editData.params.method?e("el-form-item",{attrs:{prop:"params.contentType",label:"请求体类型"}},[e("el-select",{staticStyle:{width:"100%"},model:{value:t.editData.params.contentType,callback:function(e){t.$set(t.editData.params,"contentType",e)},expression:"editData.params.contentType"}},[e("el-option",{key:"application/json",attrs:{value:"application/json",label:"application/json"}}),e("el-option",{key:"application/x-www-form-urlencoded",attrs:{value:"application/x-www-form-urlencoded",label:"application/x-www-form-urlencoded"}})],1)],1):t._e(),e("el-form-item",{attrs:{prop:"params.titleName",label:"标题参数名"}},[e("el-input",{attrs:{placeholder:"请输入标题参数名"},model:{value:t.editData.params.titleName,callback:function(e){t.$set(t.editData.params,"titleName",e)},expression:"editData.params.titleName"}})],1),e("el-form-item",{attrs:{prop:"params.needContent",label:"是否需要内容"}},[e("el-select",{staticStyle:{width:"100%"},model:{value:t.editData.params.needContent,callback:function(e){t.$set(t.editData.params,"needContent",e)},expression:"editData.params.needContent"}},[e("el-option",{key:!0,attrs:{value:!0,label:"需要"}}),e("el-option",{key:!1,attrs:{value:!1,label:"不需要"}})],1)],1),t.editData.params.needContent?e("el-form-item",{attrs:{prop:"params.contentName",label:"内容参数名"}},[e("el-input",{attrs:{placeholder:"请输入内容参数名"},model:{value:t.editData.params.contentName,callback:function(e){t.$set(t.editData.params,"contentName",e)},expression:"editData.params.contentName"}})],1):t._e()]:1==t.editData.method?[e("div",{staticClass:"tip-box"},[t._v("同时支持 "),e("a",{attrs:{href:"https://sct.ftqq.com/r/15503",target:"_blank"}},[t._v("Server酱ᵀ")]),t._v("(免费5次/天) 与 "),e("a",{attrs:{href:"https://sc3.ft07.com/",target:"_blank"}},[t._v("Server酱³")]),t._v("(公测不限次)")]),e("el-form-item",{attrs:{prop:"params.sendKey",label:"SendKey"}},[e("el-input",{attrs:{placeholder:"请输入SendKey"},model:{value:t.editData.params.sendKey,callback:function(e){t.$set(t.editData.params,"sendKey",e)},expression:"editData.params.sendKey"}})],1)]:2==t.editData.method?[e("div",{staticClass:"tip-box"},[e("a",{attrs:{href:"https://open.dingtalk.com/document/orgapp/custom-bot-creation-and-installation",target:"_blank"}},[t._v("配置指南")]),t._v(" 安全设置请采用[自定义关键字]，关键字内容为[OpenListSync]，不含中括号")]),e("el-form-item",{attrs:{prop:"params.url",label:"WebHook"}},[e("el-input",{attrs:{placeholder:"https://oapi.dingtalk.com/robot/send?access_token=xxxx"},model:{value:t.editData.params.url,callback:function(e){t.$set(t.editData.params,"url",e)},expression:"editData.params.url"}})],1)]:3==t.editData.method?[e("div",{staticClass:"tip-box"},[e("a",{attrs:{href:"https://sct.ftqq.com/forward",target:"_blank"}},[t._v("配置指南")]),t._v(" 请在企业微信管理后台获取相关参数")]),e("el-form-item",{attrs:{prop:"params.corpid",label:"企业ID"}},[e("el-input",{attrs:{placeholder:"请输入企业ID"},model:{value:t.editData.params.corpid,callback:function(e){t.$set(t.editData.params,"corpid",e)},expression:"editData.params.corpid"}})],1),e("el-form-item",{attrs:{prop:"params.agentid",label:"应用ID"}},[e("el-input",{attrs:{placeholder:"请输入应用ID/AgentId"},model:{value:t.editData.params.agentid,callback:function(e){t.$set(t.editData.params,"agentid",e)},expression:"editData.params.agentid"}})],1),e("el-form-item",{attrs:{prop:"params.corpsecret",label:"应用Secret"}},[e("el-input",{attrs:{placeholder:"请输入应用Secret",type:"password"},model:{value:t.editData.params.corpsecret,callback:function(e){t.$set(t.editData.params,"corpsecret",e)},expression:"editData.params.corpsecret"}})],1),e("el-form-item",{attrs:{prop:"params.touser",label:"接收用户"}},[e("el-input",{attrs:{placeholder:"请输入接收用户ID，多个用|分隔，@all表示全部"},model:{value:t.editData.params.touser,callback:function(e){t.$set(t.editData.params,"touser",e)},expression:"editData.params.touser"}})],1)]:t._e(),e("el-form-item",{attrs:{prop:"params.notSendNull",label:"忽略无同步"}},[e("el-switch",{attrs:{"active-value":1,"inactive-value":0},model:{value:t.editData.params.notSendNull,callback:function(e){t.$set(t.editData.params,"notSendNull",e)},expression:"editData.params.notSendNull"}})],1)],2):t._e()],1),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:t.closeShow}},[t._v("取 消")]),e("el-button",{attrs:{type:"success",loading:t.tstLoading},on:{click:function(e){return t.tstCu()}}},[t._v("测 试")]),e("el-button",{attrs:{type:"primary",loading:t.editLoading},on:{click:t.submit}},[t._v("确 定")])],1)])],2)])},i=[],l=(a("e9c4"),a("5087"),a("b775"));function n(){return Object(l["a"])({url:"/notify",headers:{isMask:!1},method:"get"})}function o(t){return Object(l["a"])({url:"/notify",headers:{isMask:!1},method:"post",data:{notify:t}})}function r(t){return Object(l["a"])({url:"/notify",headers:{isMask:!1},method:"put",data:{notify:t}})}function d(t,e){return Object(l["a"])({url:"/notify",headers:{isMask:!1},method:"put",data:{notifyId:t,enable:e}})}function c(t){return Object(l["a"])({url:"/notify",headers:{isMask:!1},method:"delete",data:{notifyId:t}})}var p=a("6bf0"),m={name:"Notify",components:{},data(){return{notifyMethodLength:p["a"].length,dataList:[],loading:!1,deleteLoading:!1,editLoading:!1,tstLoading:!1,enableLoading:!1,editData:null,editFlag:!1,editShow:!1,editRule:[{params:{url:[{type:"string",required:!0,message:"请输入地址"}],titleName:[{type:"string",required:!0,message:"请输入标题名"}],contentName:[{type:"string",required:!0,message:"请输入内容名"}]}},{params:{sendKey:[{type:"string",required:!0,message:"请输入sendKey"}]}},{params:{url:[{type:"string",required:!0,message:"请输入WebHook地址"}]}},{params:{corpid:[{type:"string",required:!0,message:"请输入企业ID"}],agentid:[{type:"string",required:!0,message:"请输入应用ID/AgentId"}],corpsecret:[{type:"string",required:!0,message:"请输入应用Secret"}],touser:[{type:"string",required:!1}]}}]}},created(){this.getData()},beforeDestroy(){},methods:{getData(){this.loading=!0,n().then(t=>{this.loading=!1,this.dataList=t.data}).catch(t=>{this.loading=!1})},addShow(){this.editFlag=!1,this.editData={enable:1,method:1,params:{sendKey:"",notSendNull:!1}},this.editShow=!0},editShowDialog(t){let e=JSON.parse(JSON.stringify(t));e.params=JSON.parse(e.params),e.params.hasOwnProperty("notSendNull")||(e.params["notSendNull"]=!1),this.editData=e,this.editFlag=!0,this.editShow=!0},methodChange(t){0===t?this.editData.params={url:"",method:"POST",contentType:"application/json",needContent:!0,titleName:"title",contentName:"content",notSendNull:!1}:1===t?this.editData.params={sendKey:"",notSendNull:!1}:2===t?this.editData.params={url:"",notSendNull:!1}:3===t&&(this.editData.params={corpid:"",agentid:"",corpsecret:"",touser:"@all",notSendNull:!1}),this.$nextTick(()=>{this.$refs.addRule.clearValidate()})},closeShow(){this.editShow=!1},enableNotify(t,e){this.enableLoading=!0,d(t,e).then(t=>{this.enableLoading=!1,this.$message({message:t.msg,type:"success"}),this.getData()}).catch(t=>{this.enableLoading=!1})},submit(){this.$refs.addRule.validate(t=>{if(t){let t=JSON.parse(JSON.stringify(this.editData));t.params=JSON.stringify(t.params),this.editLoading=!0,this.editFlag?r(t).then(t=>{this.editLoading=!1,this.$message({message:t.msg,type:"success"}),this.closeShow(),this.getData()}).catch(t=>{this.editLoading=!1}):o(t).then(t=>{this.editLoading=!1,this.$message({message:t.msg,type:"success"}),this.closeShow(),this.getData()}).catch(t=>{this.editLoading=!1})}})},tstCu(t=null){null==t?this.$refs.addRule.validate(t=>{t&&this.tstCuTrueDo(this.editData)}):this.tstCuTrueDo(t)},tstCuTrueDo(t){this.tstLoading=!0;let e=JSON.parse(JSON.stringify(t));"object"===typeof e.params&&null!==e.params&&(e.params=JSON.stringify(e.params)),delete e.enable,o(e).then(t=>{this.tstLoading=!1,this.$message({message:"测试消息已发送，请检查是否正确收到通知",type:"success"})}).catch(t=>{this.tstLoading=!1})},delCu(t){this.$confirm("操作不可逆，将永久删除该通知配置，仍要删除吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.deleteLoading=!0,c(t).then(t=>{this.deleteLoading=!1,this.$message({message:t.msg,type:"success"}),this.getData()}).catch(t=>{this.deleteLoading=!1})})}}},u=m,h=(a("368d"),a("2877")),g=Object(h["a"])(u,s,i,!1,null,null,null);e["default"]=g.exports}}]);